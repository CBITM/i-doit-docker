# i-doit Docker images

Dockerized [i-doit CMDB](https://i-doit.com/)

[![Build Status](https://travis-ci.org/bheisig/i-doit-docker.svg?branch=master)](https://travis-ci.org/bheisig/i-doit-docker)

## Not production-ready!

**The provided Docker images aren't production-ready. Please do not rely on them. They come "as is" with absolutely no warranty. They are not an official product by synetics GmbH. Therefore, we can't provide you any support.**

At the moment, we use these images for quality tests of i-doit and its add-ons. Maybe in the near-future we hope to provide you official i-doit Docker images which are well-tested and production-ready. In the meantime don't hesitate to test these images yourself. [We love to get your feedback!](https://github.com/bheisig/i-doit-docker/issues)

## Supported tags and respective `Dockerfile` links

-   `1.12.1-open-php7.0-apache` ([`Dockerfile`](1.12.1/open/php7.0/apache))
-   `1.12.1-open-php7.0-fpm` ([`Dockerfile`](1.12.1/open/php7.0/fpm))
-   `1.12.1-open-php7.1-apache` ([`Dockerfile`](1.12.1/open/php7.1/apache))
-   `1.12.1-open-php7.1-fpm` ([`Dockerfile`](1.12.1/open/php7.1/fpm))
-   `1.12.1-open-php7.2-apache` ([`Dockerfile`](1.12.1/open/php7.2/apache))
-   `1.12.1-open-php7.2-fpm` ([`Dockerfile`](1.12.1/open/php7.2/fpm))
-   `1.12.1-pro-php7.0-apache` ([`Dockerfile`](1.12.1/pro/php7.0/apache))
-   `1.12.1-pro-php7.0-fpm` ([`Dockerfile`](1.12.1/pro/php7.0/fpm))
-   `1.12.1-pro-php7.1-apache` ([`Dockerfile`](1.12.1/pro/php7.1/apache))
-   `1.12.1-pro-php7.1-fpm` ([`Dockerfile`](1.12.1/pro/php7.1/fpm))
-   `1.12.1-pro-php7.2-apache` ([`Dockerfile`](1.12.1/pro/php7.2/apache))
-   `1.12.1-pro-php7.2-fpm` ([`Dockerfile`](1.12.1/pro/php7.2/fpm))
-   `1.12.4-open-php7.0-apache` ([`Dockerfile`](1.12.4/open/php7.0/apache))
-   `1.12.4-open-php7.0-fpm` ([`Dockerfile`](1.12.4/open/php7.0/fpm))
-   `1.12.4-open-php7.1-apache` ([`Dockerfile`](1.12.4/open/php7.1/apache))
-   `1.12.4-open-php7.1-fpm` ([`Dockerfile`](1.12.4/open/php7.1/fpm))
-   `1.12.4-open-php7.2-apache` ([`Dockerfile`](1.12.4/open/php7.2/apache))
-   `1.12.4-open-php7.2-fpm` ([`Dockerfile`](1.12.4/open/php7.2/fpm))
-   `1.12.4-pro-php7.0-apache` ([`Dockerfile`](1.12.4/pro/php7.0/apache))
-   `1.12.4-pro-php7.0-fpm` ([`Dockerfile`](1.12.4/pro/php7.0/fpm))
-   `1.12.4-pro-php7.1-apache` ([`Dockerfile`](1.12.4/pro/php7.1/apache))
-   `1.12.4-pro-php7.1-fpm` ([`Dockerfile`](1.12.4/pro/php7.1/fpm))
-   `1.12.4-pro-php7.2-apache` ([`Dockerfile`](1.12.4/pro/php7.2/apache))
-   `1.12.4-pro-php7.2-fpm` ([`Dockerfile`](1.12.4/pro/php7.2/fpm))
-   `1.13-open-php7.0-apache` ([`Dockerfile`](1.13/open/php7.0/apache))
-   `1.13-open-php7.0-fpm` ([`Dockerfile`](1.13/open/php7.0/fpm))
-   `1.13-open-php7.1-apache` ([`Dockerfile`](1.13/open/php7.1/apache))
-   `1.13-open-php7.1-fpm` ([`Dockerfile`](1.13/open/php7.1/fpm))
-   `1.13-open-php7.2-apache` ([`Dockerfile`](1.13/open/php7.2/apache))
-   `1.13-open-php7.2-fpm` ([`Dockerfile`](1.13/open/php7.2/fpm))
-   `1.13-open-php7.3-apache` ([`Dockerfile`](1.13/open/php7.3/apache))
-   `1.13-open-php7.3-fpm` ([`Dockerfile`](1.13/open/php7.3/fpm))
-   `1.13-pro-php7.0-apache` ([`Dockerfile`](1.13/pro/php7.0/apache))
-   `1.13-pro-php7.0-fpm` ([`Dockerfile`](1.13/pro/php7.0/fpm))
-   `1.13-pro-php7.1-apache` ([`Dockerfile`](1.13/pro/php7.1/apache))
-   `1.13-pro-php7.1-fpm` ([`Dockerfile`](1.13/pro/php7.1/fpm))
-   `1.13-pro-php7.2-apache` ([`Dockerfile`](1.13/pro/php7.2/apache))
-   `1.13-pro-php7.2-fpm` ([`Dockerfile`](1.13/pro/php7.2/fpm))
-   `1.13-pro-php7.3-apache` ([`Dockerfile`](1.13/pro/php7.3/apache))
-   `1.13-pro-php7.3-fpm` ([`Dockerfile`](1.13/pro/php7.3/fpm))

## Quick reference

-   **Where to get help**:  
    [https://github.com/bheisig/i-doit-docker/issues](https://github.com/bheisig/i-doit-docker/issues)
-   **Where to file issues**:  
    [https://github.com/bheisig/i-doit-docker/issues](https://github.com/bheisig/i-doit-docker/issues)
-   **Maintained by**:  
    [Benjamin Heisig](https://benjamin.heisig.name/)
-   **Supported architectures**: x86_64
-   **Source of this description**:  
    [`README.md`](https://github.com/bheisig/i-doit-docker/blob/master/README.md)
-   **Supported Docker versions**:  
    [the latest release](https://github.com/docker/docker-ce/releases/latest) (down to 1.6 on a best-effort basis)

## What is i-doit?

i-doit is a configuration management database (CMDB), IT asset management (ITAM) and IT documentation tool

## How to use this image

Each image is build on the official PHP Docker image. We've got heavily inspired by the well-documented [Nextcloud docker image](https://github.com/nextcloud/docker).

### Run i-doit with Apache HTTPD

Run the latest version of i-doit pro with PHP 7.3 and Apache HTTPD 2.4:

~~~ {.bash}
docker run --name i-doit-apache -p 80:80 bheisig/idoit:1.13-pro-php7.3-apache
~~~

### Run i-doit with PHP-FPM

Run the latest version of i-doit pro with PHP 7.3 and FPM:

~~~ {.bash}
docker run --name i-doit-fpm -p 9000:9000 bheisig/idoit:1.13-pro-php7.3-fpm
~~~

### Available volumes

Each i-doit container has one default volume containing the complete installation directory: `/var/www/html`. This directory includes the source code, cache files, uploaded files, installed add-ons, custom translation files, etc.

### Run i-doit with Docker Compose

i-doit requires either MariaDB or MySQL as the database backend. Additionally, memcached is highly recommend. There are some examples:

-   [Run with Apache HTTPD](docker-compose-apache.yml)
-   [Run with PHP-FPM](docker-compose-fpm.yml)
-   [Run with PHP-FPM and UNIX sockets](docker-compose-sockets.yml)

### Run i-doit CLI tool

i-doit has its own CLI tool named `console.php` for long-lasting, recurring tasks or automating things in background. You can execute any CLI command in the running Docker container, for example:

~~~ {.bash}
docker exec -it --user www-data i-doit-fpm php console.php --help
~~~

### Update i-doit

_This is currently not working as smoothly as expected._

### Backup and restore

For a fully backup and restore process you need to consider at least 3 sources:

1.  i-doit installation directory (see section "Available volumes")
2.  System database (default: `idoit_system`)
3.  Each tenant database (default 1st one: `idoit_data`)

As you can see in the examples for `docker-compose` (see section "Run i-doit with Docker Compose") the simplest thing is to backup the named volumes. But for a running instance of MariaDB this is a bad solution because everything stored temporarily in memory won't be backed up. Therefore, run `mysqldump` (for backup) and `mysql` (for restore) to fetch every bit stored in the databases.

This is a basic example to backup everything in a running environment:

~~~ {.bash}
docker exec i-doit-fpm /bin/tar cvf - . | gzip -9 > backup.tar.gz
docker exec i-doit-fpm /usr/bin/mysqldump -uidoit -pidoit --all-databases | gzip -9 > backup.sql.gz
~~~

This is a basic example to restore those backups:

~~~ {.bash}
cat backup.tar.gz | docker exec --interactive --user www-data i-doit-fpm /bin/tar xzvf -
gunzip < backup.sql.gz | docker exec --interactive i-doit-fpm /usr/bin/mysql -uidoit -pidoit
~~~

Don't forget to alter the commands above to your needs.

### Add a subscription license

_since i-doit v1.13_

Copy the file to the running i-doit container and import the file with the i-doit CLI tool:

~~~ {.bash}
docker cp license.txt i-doit-fpm:/tmp/
docker exec --interactive --user www-data i-doit-fpm php \
    console.php license-add \
    --user admin --password admin --no-interaction --license /tmp/license.txt
~~~

### Move your CMDB data to a container

There are no general instructions for this job because every environment is slightly different. The next example assumes that i-doit is currently installed on the same host as the running i-doit container:

~~~ {.bash}
cd /var/www/html/
tar czvf - . | docker exec --interactive --user www-data i-doit-fpm /bin/tar xzvf -
mysqldump -uidoit -pidoit --all-databases | \
    docker exec --interactive i-doit-fpm /usr/bin/mysql -uidoit -pidoit
~~~

### TLS/HTTPS

It is _strongly_ recommended to access i-doit in a productive environment only via TLS/HTTPS. The provided images do not terminate TLS/HTTPS connections. Therefore, you need an additional load balancer or similar.

## Image variants

`<version>-<edition>-<php>-<service>`

-   `<version>`: Which version of i-doit do you like to run? Omit to run the latest version.
-   `<edition>`: Which edition of i-doit do you like to run? Select `open` for community edition (Free Software) and `pro` for professional edition (proprietary). Omit to go `pro`.
-   `<php>`: Which version of [PHP](https://php.net/) do you like to run? Omit to run the latest stable version.
-   `<service>`: Decide to run i-doit either with [Apache HTTPD](https://httpd.apache.org/), [Nginx](https://nginx.org/) or [PHP-FPM](https://php-fpm.org/)

## Copyright & license

Copyright (C) 2019 [synetics GmbH](https://i-doit.com/)

Licensed under the [GNU Affero GPL version 3 or later (AGPLv3+)](https://gnu.org/licenses/agpl.html). This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law.
